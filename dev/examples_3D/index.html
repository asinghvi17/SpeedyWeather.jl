<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples 3D · SpeedyWeather.jl</title><meta name="title" content="Examples 3D · SpeedyWeather.jl"/><meta property="og:title" content="Examples 3D · SpeedyWeather.jl"/><meta property="twitter:title" content="Examples 3D · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../large_scale_condensation/">Large-scale condensation</a></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li><a class="tocitem" href="../surface_fluxes/">Surface fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox" checked/><label class="tocitem" for="menuitem-6"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li class="is-active"><a class="tocitem" href>Examples 3D</a><ul class="internal"><li><a class="tocitem" href="#Jablonowski-Williamson-baroclinic-wave"><span>Jablonowski-Williamson baroclinic wave</span></a></li><li><a class="tocitem" href="#Held-Suarez-forcing"><span>Held-Suarez forcing</span></a></li><li><a class="tocitem" href="#Aquaplanet"><span>Aquaplanet</span></a></li><li><a class="tocitem" href="#Aquaplanet-without-(deep)-convection"><span>Aquaplanet without (deep) convection</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li><a class="tocitem" href="../land_sea_mask/">Land-Sea Mask</a></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularMatrices</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running SpeedyWeather</a></li><li class="is-active"><a href>Examples 3D</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples 3D</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/examples_3D.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples-3D"><a class="docs-heading-anchor" href="#Examples-3D">Examples 3D</a><a id="Examples-3D-1"></a><a class="docs-heading-anchor-permalink" href="#Examples-3D" title="Permalink"></a></h1><p>The following showcases several examples of SpeedyWeather.jl simulating the <a href="../primitiveequation/#primitive_equation_model">Primitive equations</a> with and without humidity and with and without physical parameterizations.</p><p>See also <a href="../examples_2D/#Examples">Examples 2D</a> for examples with the <a href="../barotropic/#barotropic_vorticity_model">Barotropic vorticity equation</a> and the <a href="../shallowwater/#shallow_water_model">shallow water model</a>.</p><h2 id="Jablonowski-Williamson-baroclinic-wave"><a class="docs-heading-anchor" href="#Jablonowski-Williamson-baroclinic-wave">Jablonowski-Williamson baroclinic wave</a><a id="Jablonowski-Williamson-baroclinic-wave-1"></a><a class="docs-heading-anchor-permalink" href="#Jablonowski-Williamson-baroclinic-wave" title="Permalink"></a></h2><pre><code class="language-julia hljs">using SpeedyWeather
spectral_grid = SpectralGrid(trunc=31, nlev=8, Grid=FullGaussianGrid, dealiasing=3)

orography = ZonalRidge(spectral_grid)
initial_conditions = InitialConditions(
    vordiv = ZonalWind(),
    temp = JablonowskiTemperature(),
    pres = ZeroInitially())

model = PrimitiveDryModel(; spectral_grid, orography, initial_conditions, physics=false)
simulation = initialize!(model)
run!(simulation, period=Day(9))</code></pre><p>The Jablonowski-Williamson baroclinic wave test case<sup class="footnote-reference"><a id="citeref-JW06" href="#footnote-JW06">[JW06]</a></sup> using the <a href="../primitiveequation/#primitive_equation_model">Primitive equation model</a> particularly the dry model, as we switch off all physics with <code>physics=false</code>. We want to use 8 vertical levels, and a lower resolution of T31 on a <a href="../grids/#FullGaussianGrid">full Gaussian grid</a>. The Jablonowski-Williamson initial conditions are <code>ZonalWind</code> for vorticity and divergence (curl and divergence of <span>$u, v$</span>), <code>JablonowskiTemperature</code> for temperature and <code>ZeroInitially</code> for pressure. The orography is just a <code>ZonalRidge</code>. There is no forcing and the initial conditions are baroclinically unstable which kicks off a wave propagating eastward. This wave becomes obvious when visualised with</p><pre><code class="language-julia hljs">using CairoMakie

vor = simulation.diagnostic_variables.layers[end].grid_variables.vor_grid
heatmap(vor, title=&quot;Surface relative vorticity&quot;)</code></pre><p><img src="../jablonowski.png" alt="Jablonowski pyplot"/></p><h2 id="Held-Suarez-forcing"><a class="docs-heading-anchor" href="#Held-Suarez-forcing">Held-Suarez forcing</a><a id="Held-Suarez-forcing-1"></a><a class="docs-heading-anchor-permalink" href="#Held-Suarez-forcing" title="Permalink"></a></h2><pre><code class="language-julia hljs">using SpeedyWeather
spectral_grid = SpectralGrid(trunc=31, nlev=8)

# construct model with only Held-Suarez forcing, no other physics
model = PrimitiveDryModel(;
    spectral_grid,

    # Held-Suarez forcing and drag
    temperature_relaxation = HeldSuarez(spectral_grid),
    boundary_layer_drag = LinearDrag(spectral_grid),

    # switch off other physics
    convection = NoConvection(),
    shortwave_radiation = NoShortwave(),
    longwave_radiation = NoLongwave(),
    vertical_diffusion = NoVerticalDiffusion(),

    # switch off surface fluxes (makes ocean/land/land-sea mask redundant)
    surface_wind = NoSurfaceWind(),
    surface_heat_flux = NoSurfaceHeatFlux(),

    # use Earth&#39;s orography
    orography = EarthOrography(spectral_grid)
)

simulation = initialize!(model)
run!(simulation, period=Day(20))</code></pre><p>The code above defines the Held-Suarez forcing <sup class="footnote-reference"><a id="citeref-HS94" href="#footnote-HS94">[HS94]</a></sup> in terms of temperature relaxation and a linear drag term that is applied near the planetary boundary but switches off all other physics in the primitive equation model without humidity. Switching off the surface wind would also automatically turn off the surface evaporation (not relevant in the primitive <em>dry</em> model) and sensible heat flux as that one is proportional to the surface wind (which is zero with <code>NoSurfaceWind</code>). But to also avoid the calculation being run at all we use <code>NoSurfaceHeatFlux()</code> for the model constructor. Many of the <code>NoSomething</code> model components do not require the spectral grid to be passed on, but as a convention we allow every model component to have it for construction even if not required.</p><p>Visualising surface temperature with</p><pre><code class="language-julia hljs">using CairoMakie

temp = simulation.diagnostic_variables.layers[end].grid_variables.temp_grid
heatmap(temp, title=&quot;Surface temperature [K]&quot;, colormap=:thermal)</code></pre><p><img src="../heldsuarez.png" alt="Held-Suarez"/></p><h2 id="Aquaplanet"><a class="docs-heading-anchor" href="#Aquaplanet">Aquaplanet</a><a id="Aquaplanet-1"></a><a class="docs-heading-anchor-permalink" href="#Aquaplanet" title="Permalink"></a></h2><pre><code class="language-julia hljs">using SpeedyWeather

# components
spectral_grid = SpectralGrid(trunc=31, nlev=5)
ocean = AquaPlanet(spectral_grid, temp_equator=302, temp_poles=273)
land_sea_mask = AquaPlanetMask(spectral_grid)
orography = NoOrography(spectral_grid)

# create model, initialize, run
model = PrimitiveWetModel(; spectral_grid, ocean, land_sea_mask, orography)
simulation = initialize!(model)
run!(simulation, period=Day(50))</code></pre><p>Here we have defined an aquaplanet simulation by</p><ul><li>creating an <code>ocean::AquaPlanet</code>. This will use constant sea surface temperatures that only vary with latitude.</li><li>creating a <code>land_sea_mask::AquaPlanetMask</code> this will use a land-sea mask with <code>false</code>=ocean everywhere.</li><li>creating an <code>orography::NoOrography</code> which will have no orography and zero surface geopotential.</li></ul><p>All passed on to the model constructor for a <code>PrimitiveWetModel</code>, we have now a model with humidity and physics parameterization as they are defined by default (typing <code>model</code> will give you an overview of its components). We could have change the <code>model.land</code> and <code>model.vegetation</code> components too, but given the land-sea masks masks those contributions to the surface fluxes anyway, this is not necessary. Note that neither sea surface temperature, land-sea mask or orography have to agree. It is possible to have an ocean on top of a mountain. For an ocean grid-cell that is (partially) masked by the land-sea mask, its value will be (fractionally) ignored in the calculation of surface fluxes (potentially leading to a zero flux depending on land surface temperatures).</p><p>Now with the following we visualize the surface humidity after the 50 days of simulation. We use 50 days as without mountains it takes longer for the initial conditions to become unstable. The surface humidity shows small-scale patches in the tropics, which is a result of the convection scheme, causing updrafts and downdrafts in both humidity and temperature.</p><pre><code class="language-julia hljs">using CairoMakie

humid = simulation.diagnostic_variables.layers[end].grid_variables.humid_grid
heatmap(humid, title=&quot;Surface specific humidity [kg/kg]&quot;, colormap=:oslo)</code></pre><p><img src="../aquaplanet.png" alt="Aquaplanet"/></p><h2 id="Aquaplanet-without-(deep)-convection"><a class="docs-heading-anchor" href="#Aquaplanet-without-(deep)-convection">Aquaplanet without (deep) convection</a><a id="Aquaplanet-without-(deep)-convection-1"></a><a class="docs-heading-anchor-permalink" href="#Aquaplanet-without-(deep)-convection" title="Permalink"></a></h2><p>Now we want to compare the previous simulation to a simulation without deep convection, called <code>DryBettsMiller</code>, because it is the <a href="../convection/#BettsMiller">Betts-Miller convection</a> but with humidity set to zero in which case the convection is always non-precipitating <em>shallow</em> (because the missing latent heat release from condensation makes it shallower) convection. In fact, this convection is the default when using the <code>PrimitiveDryModel</code>. Instead of redefining the <a href="#Aquaplanet">Aquaplanet</a> setup again, we simply reuse these components <code>spectral_grid</code>, <code>ocean</code>, <code>land_sea_mask</code> and <code>orography</code> (because <code>spectral_grid</code> hasn&#39;t changed this is possible).</p><pre><code class="language-julia hljs"># Execute the code from Aquaplanet above first!
convection = DryBettsMiller(spectral_grid, time_scale=Hour(4))

# reuse other model components from before
model = PrimitiveWetModel(; spectral_grid, ocean, land_sea_mask, orography, convection)

simulation = initialize!(model)
run!(simulation, period=Day(50))

humid = simulation.diagnostic_variables.layers[end].grid_variables.humid_grid
heatmap(humid, title=&quot;No deep convection: Surface specific humidity [kg/kg]&quot;, colormap=:oslo)</code></pre><p>But we also want to compare this to a setup where convection is completely disabled, i.e. <code>convection = NoConvection()</code> (many of the <code>No</code> model components don&#39;t require the <code>spectral_grid</code> to be passed on, but some do!)</p><pre><code class="language-julia hljs"># Execute the code from Aquaplanet above first!
convection = NoConvection(spectral_grid)

# reuse other model components from before
model = PrimitiveWetModel(; spectral_grid, ocean, land_sea_mask, orography, convection)

simulation = initialize!(model)
run!(simulation, period=Day(50))

humid = simulation.diagnostic_variables.layers[end].grid_variables.humid_grid
heatmap(humid, title=&quot;No convection: Surface specific humidity [kg/kg]&quot;, colormap=:oslo)</code></pre><p>And the comparison looks like</p><p><img src="../aquaplanet_nodeepconvection.png" alt="Aquaplanet, no deep convection"/> <img src="../aquaplanet_noconvection.png" alt="Aquaplanet, no convection"/></p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-JW06"><a class="tag is-link" href="#citeref-JW06">JW06</a>Jablonowski, C. and Williamson, D.L. (2006), A baroclinic instability test case for atmospheric model dynamical cores. Q.J.R. Meteorol. Soc., 132: 2943-2975. DOI:<a href="https://doi.org/10.1256/qj.06.12">10.1256/qj.06.12</a></li><li class="footnote" id="footnote-HS94"><a class="tag is-link" href="#citeref-HS94">HS94</a>Held, I. M. &amp; Suarez, M. J. A Proposal for the Intercomparison of the Dynamical Cores of Atmospheric General Circulation Models. Bulletin of the American Meteorological Society 75, 1825-1830 (1994). DOI:<a href="https://doi.org/10.1175/1520-0477(1994)075&lt;1825:APFTIO&gt;2.0.CO;2">10.1175/1520-0477(1994)075&lt;1825:APFTIO&gt;2.0.CO;2</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples_2D/">« Examples 2D</a><a class="docs-footer-nextpage" href="../analysis/">Analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Monday 6 May 2024 22:45">Monday 6 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
