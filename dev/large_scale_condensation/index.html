<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Large-scale condensation · SpeedyWeather.jl</title><meta name="title" content="Large-scale condensation · SpeedyWeather.jl"/><meta property="og:title" content="Large-scale condensation · SpeedyWeather.jl"/><meta property="twitter:title" content="Large-scale condensation · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Large-scale condensation</a><ul class="internal"><li><a class="tocitem" href="#Condensation-implementations"><span>Condensation implementations</span></a></li><li><a class="tocitem" href="#Explicit-large-scale-condensation"><span>Explicit large-scale condensation</span></a></li><li><a class="tocitem" href="#Implicit-large-scale-condensation"><span>Implicit large-scale condensation</span></a></li><li><a class="tocitem" href="#Large-scale-precipitation"><span>Large-scale precipitation</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li><a class="tocitem" href="../surface_fluxes/">Surface fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li><a class="tocitem" href="../examples_3D/">Examples 3D</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li><a class="tocitem" href="../land_sea_mask/">Land-Sea Mask</a></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularMatrices</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Physics</a></li><li class="is-active"><a href>Large-scale condensation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Large-scale condensation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/large_scale_condensation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Large-scale-condensation"><a class="docs-heading-anchor" href="#Large-scale-condensation">Large-scale condensation</a><a id="Large-scale-condensation-1"></a><a class="docs-heading-anchor-permalink" href="#Large-scale-condensation" title="Permalink"></a></h1><p>Large-scale condensation in an atmospheric general circulation represents the micro-physical that kicks in when an air parcel reaches saturation. Subsequently, the water vapour inside it condenses, forms droplets around condensation nuclei, which grow, become heavy and eventually fall out as precipitation. This process is never actually representable at the resolution of global (or even regional) atmospheric models as typical cloud droplets have a size of micrometers. Atmospheric models therefore rely on large-scale quantities such as specific humidity, pressure and temperature within a given grid cell, even though there might be considerably variability of these quantities within a grid cell if the resolution was higher.</p><h2 id="Condensation-implementations"><a class="docs-heading-anchor" href="#Condensation-implementations">Condensation implementations</a><a id="Condensation-implementations-1"></a><a class="docs-heading-anchor-permalink" href="#Condensation-implementations" title="Permalink"></a></h2><p>Currently implemented are</p><pre><code class="language-julia hljs">using SpeedyWeather
subtypes(SpeedyWeather.AbstractCondensation)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Any}:
 ImplicitCondensation
 NoCondensation</code></pre><p>which are described in the following.</p><h2 id="Explicit-large-scale-condensation"><a class="docs-heading-anchor" href="#Explicit-large-scale-condensation">Explicit large-scale condensation</a><a id="Explicit-large-scale-condensation-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-large-scale-condensation" title="Permalink"></a></h2><p>We parameterize this process of <em>large-scale condensation</em> when relative humidity in a grid cell reaches saturation and remove the excess humidity quickly (given time integration constraints, see below) and with an implicit (in the time integration sense) latent heat release. Vertically integrating the tendency of specific humidity due to this process is then the <em>large-scale precipitation</em>.</p><p>Immediate condensation of humidity <span>$q_i &gt; q^\star$</span> at time step <span>$i$</span> given its saturation <span>$q^\star$</span> humidity calculated from temperature <span>$T_i$</span> is</p><p class="math-container">\[\begin{aligned}
q_{i+1} - q_i &amp;= q^\star(T_i) - q_i \\
T_{i+1} - T_i &amp;= -\frac{L_v}{c_p}( q^\star(T_i) - q_i  )
\end{aligned}\]</p><p>This condensation is <em>explicit</em> in the time integration sense, meaning that we only use quantities at time step <span>$i$</span> to calculate the tendency. The latent heat release of that condensation is in the second equation. However, treating this explicitly poses the problem that because the saturation humidity is calculated from the current temperature <span>$T_i$</span>, which is increased due to the latent heat release, the humidity after this time step will be undersaturated.</p><h2 id="Implicit-large-scale-condensation"><a class="docs-heading-anchor" href="#Implicit-large-scale-condensation">Implicit large-scale condensation</a><a id="Implicit-large-scale-condensation-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-large-scale-condensation" title="Permalink"></a></h2><p>Ideally, one would want to condense towards the <em>new</em> saturation humidity <span>$q^\star(T_{i+1})$</span> at <span>$i+1$</span> so that condensation draws the relative humidity back down to 100% not below it.  Taylor expansion at <span>$i$</span> of the equation above with <span>$q^\star(T_{i+1})$</span> and <span>$\Delta T = T_{i+1} - T_i$</span> (and <span>$\Delta q$</span> similarly) to first order yields</p><p class="math-container">\[q_{i+1} - q_i = q^\star(T_{i+1}) - q_i = q^\star(T_i) + (T_{i+1} - T_i)
\frac{\partial q^\star}{\partial T} (T_i) + O(\Delta T^2) - q_i\]</p><p>Now we make a linear approximation to the derivative and drop the <span>$O(\Delta T^2)$</span> term. Inserting the (explicit) latent heat release yields</p><p class="math-container">\[\Delta q = q^\star(T_i) + -\frac{L_v}{c_p} \Delta q \frac{\partial q^\star}{\partial T} (T_i) - q_i\]</p><p>And solving for <span>$\Delta q$</span> yields</p><p class="math-container">\[\left[ 1 + \frac{L_v}{c_p} \frac{\partial q^\star}{\partial T} (T^i) \right] \Delta q = q^\star(T_i) - q_i\]</p><p>meaning that the implicit immediate condensation can be formulated as (see also <sup class="footnote-reference"><a id="citeref-Frierson2006" href="#footnote-Frierson2006">[Frierson2006]</a></sup>)</p><p class="math-container">\[\begin{aligned}
q_{i+1} - q_i &amp;= \frac{q^\star(T_i) - q_i}{1 + \frac{L_v}{c_p} \frac{\partial q^\star}{\partial T}(T_i)} \\
T_{i+1} - T_i &amp;= -\frac{L_v}{c_p}( q_{i+1} - q_i )
\end{aligned}\]</p><p>With Euler forward time stepping this is great, but with our <a href="../barotropic/#leapfrog">leapfrog timestepping + RAW filter</a> this is very dispersive (see <a href="https://github.com/SpeedyWeather/SpeedyWeather.jl/issues/445">#445</a>) although the implicit formulation is already much better. We therefore introduce a time step <span>$\Delta t_c$</span> which makes the implicit condensation not immediate anymore but over several time steps <span>$\Delta t$</span> of the leapfrogging.</p><p class="math-container">\[\begin{aligned}
\delta q = \frac{q_{i+1} - q_i}{\Delta t} &amp;= \frac{q^\star(T_i) - q_i}{ \Delta t_c
\left( 1 + \frac{L_v}{c_p} \frac{\partial q^\star}{\partial T}(T_i) \right)} \\
\delta T = \frac{T_{i+1} - T_i}{\Delta t} &amp;= -\frac{L_v}{c_p}( \frac{q_{i+1} - q_i}{\Delta t} )
\end{aligned}\]</p><p>For <span>$\Delta t = \Delta t_c$</span> we have an immediate condensation, for <span>$n = \frac{\Delta t_c}{\Delta t}$</span> condensation takes place over <span>$n$</span> time steps. One could tie this time scale for condensation to a physical unit, like 6 hours, but because the time step here is ideally short, but cannot be too short for numerical stability, we tie it here to the time step of the numerical integration. This also means that at higher resolution condensation is more immediate than at low resolution, but the dispersive time integration of this term is in all cases similar (and not much higher at lower resolution).</p><h2 id="Large-scale-precipitation"><a class="docs-heading-anchor" href="#Large-scale-precipitation">Large-scale precipitation</a><a id="Large-scale-precipitation-1"></a><a class="docs-heading-anchor-permalink" href="#Large-scale-precipitation" title="Permalink"></a></h2><p>The tendencies <span>$\delta q$</span> in units of  kg/kg/s are vertically integrated to diagnose the large-scale precipitation <span>$P$</span> in units of meters</p><p class="math-container">\[P = -\int \frac{\Delta t}{g \rho} \delta q dp\]</p><p>with gravity <span>$g$</span>, water density <span>$\rho$</span> and time step <span>$\Delta t$</span>. <span>$P$</span> is therefore interpreted as the amount of precipitation that falls down during the time step <span>$\Delta t$</span> of the time integration. Note that <span>$\delta q$</span> is always negative due to the <span>$q &gt; q^\star$</span> condition for saturation, hence <span>$P$</span> is positive only. It is then accumulated over several time steps, e.g. over the course of an hour to yield a typical rain rate of mm/h. The water density is taken as reference density of <span>$1000~kg/m^3$</span></p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Frierson2006"><a class="tag is-link" href="#citeref-Frierson2006">Frierson2006</a>Frierson, D. M. W., I. M. Held, and P. Zurita-Gotor, 2006: A Gray-Radiation Aquaplanet Moist GCM. Part I: Static Stability and Eddy Scale. J. Atmos. Sci., 63, 2548-2566, DOI:<a href="https://doi.org/10.1175/JAS3753.1">10.1175/JAS3753.1</a>.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../primitiveequation/">« Primitive equation model</a><a class="docs-footer-nextpage" href="../convection/">Convection »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Monday 6 May 2024 22:45">Monday 6 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
