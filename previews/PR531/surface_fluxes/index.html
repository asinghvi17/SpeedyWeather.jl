<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Surface fluxes · SpeedyWeather.jl</title><meta name="title" content="Surface fluxes · SpeedyWeather.jl"/><meta property="og:title" content="Surface fluxes · SpeedyWeather.jl"/><meta property="twitter:title" content="Surface fluxes · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../large_scale_condensation/">Large-scale condensation</a></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li class="is-active"><a class="tocitem" href>Surface fluxes</a><ul class="internal"><li><a class="tocitem" href="#Surface-flux-implementations"><span>Surface flux implementations</span></a></li><li><a class="tocitem" href="#Fluxes-to-tendencies"><span>Fluxes to tendencies</span></a></li><li><a class="tocitem" href="#Bulk-Richardson-based-drag-coefficient"><span>Bulk Richardson-based drag coefficient</span></a></li><li><a class="tocitem" href="#Surface-momentum-fluxes"><span>Surface momentum fluxes</span></a></li><li><a class="tocitem" href="#Surface-heat-fluxes"><span>Surface heat fluxes</span></a></li><li><a class="tocitem" href="#Surface-evaporation"><span>Surface evaporation</span></a></li><li><a class="tocitem" href="#Land-sea-mask"><span>Land-sea mask</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li><a class="tocitem" href="../examples_3D/">Examples 3D</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li><a class="tocitem" href="../land_sea_mask/">Land-Sea Mask</a></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularMatrices</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Physics</a></li><li class="is-active"><a href>Surface fluxes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Surface fluxes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/surface_fluxes.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Surface-fluxes"><a class="docs-heading-anchor" href="#Surface-fluxes">Surface fluxes</a><a id="Surface-fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-fluxes" title="Permalink"></a></h1><p>The surfaces fluxes in SpeedyWeather represent the exchange of momentum, heat, and moisture between ocean and land as surface into the lowermost atmospheric layer. Surface fluxes of momentum represent a drag that the boundary layer wind experiences due to friction over more or less rough ground on land or over sea. Surface fluxes of heat represent a sensible heat flux from  a warmer or colder ocean or land into or out of the surface layer of the atmosphere. Surface fluxes of moisture represent evaporation of sea water into undersaturated surface air masses or, similarly, evaporation from land with a given soil moisture and vegetation&#39;s evapotranspiration.</p><h2 id="Surface-flux-implementations"><a class="docs-heading-anchor" href="#Surface-flux-implementations">Surface flux implementations</a><a id="Surface-flux-implementations-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-flux-implementations" title="Permalink"></a></h2><p>Currently implemented surface fluxes of momentum are</p><pre><code class="language-julia hljs">using SpeedyWeather
subtypes(SpeedyWeather.AbstractSurfaceWind)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Any}:
 NoSurfaceWind
 SurfaceWind</code></pre><div class="admonition is-info"><header class="admonition-header">Interdependence of surface flux computations</header><div class="admonition-body"><p><code>SurfaceWind</code> computes the surface fluxes of momentum but also the computation of the surface wind (which by default includes wind gusts) meaning that <code>NoSurfaceWind</code> will also effectively disable other surface fluxes unless custom surface fluxes have been implemented that do not rely on <code>column.surface_wind_speed</code>.</p></div></div><p>with more explanation below. The surface heat fluxes currently implemented are</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractSurfaceHeatFlux)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Any}:
 NoSurfaceHeatFlux
 SurfaceHeatFlux</code></pre><p>and the surface moisture fluxes, i.e. evaporation (this does not include <a href="../convection/#Convection">Convection</a> or <a href="../large_scale_condensation/#Large-scale-condensation">Large-scale condensation</a> which currently immediately removes humidity instead of fluxing it out at the bottom) implemented are</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractSurfaceEvaporation)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Any}:
 NoSurfaceEvaporation
 SurfaceEvaporation</code></pre><p>The calculation of thermodynamic quantities at the surface (air density, temperature, humidity) are handled by</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractSurfaceThermodynamics)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Any}:
 SurfaceThermodynamicsConstant</code></pre><p>and the computation of drag coefficients (which is used by default for the surface fluxes above) is handled through the <code>model.boundary_layer</code> where currently implemented are</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractBoundaryLayer)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Any}:
 BulkRichardsonDrag
 ConstantDrag
 LinearDrag
 NoBoundaryLayerDrag</code></pre><p>Note that <code>LinearDrag</code> is the linear drag following Held and Suarez (see <a href="../examples_3D/#Held-Suarez-forcing">Held-Suarez forcing</a>) which does not compute a drag coefficient and therefore by default effectively disables other surface fluxes (as the Held and Suarez forcing and drag is supposed to be used instead of physical parameterizations).</p><h2 id="Fluxes-to-tendencies"><a class="docs-heading-anchor" href="#Fluxes-to-tendencies">Fluxes to tendencies</a><a id="Fluxes-to-tendencies-1"></a><a class="docs-heading-anchor-permalink" href="#Fluxes-to-tendencies" title="Permalink"></a></h2><p>In SpeedyWeather.jl, parameterizations can be defined either in terms of tendencies for a given layer or as fluxes between two layers including the surface flux and a top-of-the-atmosphere flux. The upward flux <span>$F^\uparrow$</span> out of layer <span>$k+1$</span> into layer <span>$k$</span> (vertical indexing <span>$k$</span> increases downwards) is <span>$F^\uparrow_{k+h}$</span> (<span>$h = \frac{1}{2}$</span> for half, as the flux sits on the cell face, the half-layer in between <span>$k$</span> and <span>$k+1$</span>) and similarly <span>$F^\downarrow_{k+h}$</span> is the downward flux. For clarity we may define fluxes as either upward or downward depending on the process although an upward flux can always be regarded as a negative downward flux. The absorbed flux in layer <span>$k$</span> is</p><p class="math-container">\[\Delta F_k = (F^\uparrow_{k+h} - F^\uparrow_{k-h}) + (F^\downarrow_{k-h} - F^\downarrow_{k+h})\]</p><p>A quick overview of the units</p><table><tr><th style="text-align: right">Quantity</th><th style="text-align: right">Variable</th><th style="text-align: right">Unit</th><th style="text-align: right">Flux unit</th></tr><tr><td style="text-align: right">Momentum</td><td style="text-align: right">Velocity <span>$u, v$</span></td><td style="text-align: right"><span>$m/s$</span></td><td style="text-align: right"><span>$Pa = kg/m/s^2$</span></td></tr><tr><td style="text-align: right">Heat</td><td style="text-align: right">Temperature <span>$T$</span></td><td style="text-align: right"><span>$m/s$</span></td><td style="text-align: right"><span>$W/m^2 = kg/s^3$</span></td></tr><tr><td style="text-align: right">Moisture</td><td style="text-align: right">Specific humidity <span>$q$</span></td><td style="text-align: right"><span>$kg/kg$</span></td><td style="text-align: right"><span>$kg/m^2/s$</span></td></tr></table><p>The time-stepping in SpeedyWeather.jl (see <a href="../barotropic/#leapfrog">Time integration</a>) eventually requires tendencies which are calculated from the absorbed fluxes of momentum <span>$u$</span> or <span>$v$</span> and moisture <span>$q$</span> as</p><p class="math-container">\[\frac{\partial u_k}{\partial t} = \frac{g \Delta F_k}{\Delta p_k}\]</p><p>with gravity <span>$g$</span> and layer-thickness <span>$\Delta p_k$</span> (see <a href="../primitiveequation/#Sigma-coordinates">Sigma coordinates</a>) so that the right-hand side divides the absorbed flux by the mass of layer <span>$k$</span> (per unit area). Tendencies for <span>$v, q$</span> equivalently with their respective absorbed fluxes.</p><p>The temperature tendency is calculated from the absorbed heat flux as</p><p class="math-container">\[\frac{\partial T_k}{\partial t} = \frac{g \Delta F_k}{c_p \Delta p_k}\]</p><p>with heat capacity of air at constant pressure <span>$c_p$</span> with a typical value of <span>$1004~J/kg/K$</span>. Because we define the heat flux as having units of <span>$W/m^2$</span> the conversion includes the division by the heat capacity to convert to a rate of temperature change.</p><h2 id="Bulk-Richardson-based-drag-coefficient"><a class="docs-heading-anchor" href="#Bulk-Richardson-based-drag-coefficient">Bulk Richardson-based drag coefficient</a><a id="Bulk-Richardson-based-drag-coefficient-1"></a><a class="docs-heading-anchor-permalink" href="#Bulk-Richardson-based-drag-coefficient" title="Permalink"></a></h2><p>All surface fluxes depend on a dimensionless drag coefficient <span>$C$</span> which we calculate as a function of the bulk Richardson number <span>$Ri$</span> following Frierson, et al. 2006 <sup class="footnote-reference"><a id="citeref-Frierson2006" href="#footnote-Frierson2006">[Frierson2006]</a></sup> with some simplification as outlined below. We use the same drag coefficient for momentum, heat and moisture fluxes. The bulk Richardson number at the lowermost model layer <span>$k = N$</span> of height <span>$z_N$</span> is</p><p class="math-container">\[Ri_N = \frac{gz_N \left( \Theta_v(z_N) - \Theta_v(0) \right)}{|v(z_N)|^2 \Theta_v(0)}\]</p><p>with <span>$gz_N = \Phi_N$</span> the <a href="../primitiveequation/#Geopotential">Geopotential</a> at <span>$z = z_N$</span>, <span>$\Theta =  c_pT_v + gz$</span> the virtual dry static energy and <span>$T_v$</span> the <a href="../primitiveequation/#Virtual-temperature">Virtual temperature</a>. Then the drag coefficient <span>$C$</span> follows as</p><p class="math-container">\[C = \begin{cases}
        \kappa^2 \left( \log(\frac{z_N}{z_0}) \right)^{-2} \quad &amp;\text{for} \quad Ri_N  \leq 0\\
        \kappa^2 \left( \log(\frac{z_N}{z_0}) \right)^{-2} \left(1 - \frac{Ri_N}{Ri_c}\right)^2 \quad &amp;\text{for} \quad 0 &lt; Ri_N &lt; Ri_c \\
        0 \quad &amp;\text{for} \quad Ri_N \geq Ri_c. \\
    \end{cases}\]</p><p>with <span>$\kappa = 0.4$</span> the von Kármán constant, <span>$z_0 = 3.21 \cdot 10^{-5}$</span> the  roughness length. There is a maximum drag <span>$C$</span> for negative bulk Richardson numbers <span>$Ri_N$</span> but the drag becomes 0 for bulk Richardson numbers being larger than a critical <span>$Ri_c = 1$</span> with a smooth transition in between. The height of the <span>$N$</span>-th model layer is <span>$z_N = \tfrac{\Phi_N - \Phi_0}{g}$</span> with the geopotential</p><p class="math-container">\[\Phi_N = \Phi_{0} + T_N R_d ( \log p_{N+h} - \log p_N)\]</p><p>which depends on the temperature <span>$T_N$</span> of that layer. To simplify this calculation and avoid the logarithm we use a constant <span>$Z \approx z_N$</span> from a reference temperature <span>$T_{ref}$</span> instead of <span>$T_N$</span> in the calculation of <span>$log(z_N/z_0)$</span>. While <span>$z_N$</span> depends on the vertical resolution (<span>$\Delta p_N$</span> of the lowermost layer) it is proportional to that layer&#39;s temperature which in Kelvin does not change much in space and in time, especially with the logarithm applied. For <span>$T_{ref} = 200K$</span> with specific gas constant <span>$R_d = 287 J/kg/K$</span> on sigma level <span>$\sigma_N = 0.95$</span> we have <span>$log(z_N/z_0) \approx 16.1$</span> for <span>$T_{ref} = 300K$</span> this increases to <span>$log(z_N/z_0) \approx 16.5$</span> a 2.5% increase which we are happy to approximate. Note that we do not apply this approximation within the bulk Richardson number <span>$Ri_N$</span>. So we calculate once a typical height of the lowermost layer <span>$Z = T_{ref}R_d \log(1/\sigma_N)g^{-1}$</span> for the given parameter choices and then define a maximum drag constant</p><p class="math-container">\[C_{max} = \left(\frac{\kappa}{\log(\frac{Z}{z_0})} \right)^2\]</p><p>to simplify the drag coefficient calculation to</p><p class="math-container">\[C = C_{max} \left(1 - \frac{Ri_N^*}{Ri_c}\right)^2\]</p><p>with <span>$Ri_N^* = \max(0, \min(Ri_N, Ri_c))$</span> the clamped <span>$Ri_N$</span> which is at least <span>$0$</span> and at most <span>$Ri_c$</span>.</p><h2 id="Surface-momentum-fluxes"><a class="docs-heading-anchor" href="#Surface-momentum-fluxes">Surface momentum fluxes</a><a id="Surface-momentum-fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-momentum-fluxes" title="Permalink"></a></h2><p>The surface momentum flux is calculated from the surface wind velocities</p><p class="math-container">\[u_s = f_w u_N, \quad v_s = f_w v_N\]</p><p>meaning it is scaled down by <span>$f_w = 0.95$</span> (Fortran SPEEDY default, <sup class="footnote-reference"><a id="citeref-SPEEDY" href="#footnote-SPEEDY">[SPEEDY]</a></sup>) from the lowermost layer wind velocities <span>$u_N, v_N$</span>. A wind speed scale accounting for gustiness with <span>$V_{gust} = 5~m/s$</span> (Fortran SPEEDY default, <sup class="footnote-reference"><a id="citeref-SPEEDY" href="#footnote-SPEEDY">[SPEEDY]</a></sup>) is then defined as</p><p class="math-container">\[V_0 = \sqrt{u_s^2 + v_s^2 + V_{gust}^2}\]</p><p>such that for low wind speeds the fluxes are somewhat higher because of unresolved winds on smaller time and length scales. The momentum flux is then</p><p class="math-container">\[\begin{aligned}
F_u^\uparrow &amp;= - \rho_s C V_0 u_s \\
F_v^\uparrow &amp;= - \rho_s C V_0 v_s
\end{aligned}\]</p><p>with <span>$\rho_s = \frac{p_s}{R_d T_N}$</span> the surface air density calculated from surface pressure <span>$p_s$</span> and lowermost layer temperature <span>$T_N$</span>. Better would be to extrapolate <span>$T_N$</span> to <span>$T_s$</span> a surface air temperature assuming adiabatic descent but that is currently not implemented. In practice we use a flux limiter for numerical stability which limits the magnitude (preserving the sign). Choosing <span>$F_{uv, max}^\uparrow = 0.5 Pa$</span> would mean that the drag for winds faster than about <span>$33~m/s$</span> (typical <span>$C = 5\cdot 10^{-4}$</span>) does not further increase. This can help to prevent oscillations drag terms can produce for sudden strong wind gusts.</p><h2 id="Surface-heat-fluxes"><a class="docs-heading-anchor" href="#Surface-heat-fluxes">Surface heat fluxes</a><a id="Surface-heat-fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-heat-fluxes" title="Permalink"></a></h2><p>The surface heat flux is proportional to the difference of the surface air temperature <span>$T_s$</span> and the land or ocean skin temperature <span>$T_{skin}$</span>. We currently just approximate as <span>$T_N$</span> the lowermost layer temperature although an adiabatic descent from pressure <span>$p_N$</span> to surface pressure <span>$p_s$</span> would be more accurate. We also use land and sea surface temperature to approximate <span>$T_{skin}$</span> although future improvements should account for faster radiative effects on <span>$T_{skin}$</span> compared to sea and land surface temperatures determined by a higher heat capacity of the relevant land surface layer or the mixed layer in the ocean. We then compute</p><p class="math-container">\[F_T^\uparrow = \rho_s C V_0 c_p (T_{skin} - T_s)\]</p><p>and apply a similar flux limiter as for the momentum flux to prevent a sudden strong heating or cooling. For <span>$F_{T, max}^\uparrow = 100~W/m^2$</span> </p><h2 id="Surface-evaporation"><a class="docs-heading-anchor" href="#Surface-evaporation">Surface evaporation</a><a id="Surface-evaporation-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-evaporation" title="Permalink"></a></h2><p>The surface moisture flux, i.e. evaporation of soil moisture over land and evaporation of sea water over the ocean is proportional to the difference of the surface specific humidity <span>$q_s$</span> and the saturation specific humidity given <span>$T_{skin}$</span> and surface pressure <span>$p_s$</span>. This assumes that a very thin layer of air just above the ocean is saturated but over land this assumption is less well justified as it should be a function of the soil moisture and how much of that is available to evaporate given vegetation. We again make the simplification that <span>$q_s = q_N$</span>, i.e. specific humidity of the surface is the same as in the lowermost atmospheric layer above. </p><p>The surface evaporative flux is then (always positive)</p><p class="math-container">\[F_q^\uparrow = \rho_s C V_0 \max(0, \alpha_{sw} q^* - q_s)\]</p><p>with <span>$q^*$</span> the saturation specific humidity calculated from the skin temperature <span>$T_{skin}$</span> and surface pressure <span>$p_s$</span>. The available of soil water over land is represented by (over the ocean <span>$\alpha_{sw} = 1$</span>)</p><p class="math-container">\[\alpha_{sw} = \frac{D_{top} W_{top} + f_{veg} D_{root} \max(0, W_{root} - W_{wil})}{
    D_{top}W_{cap} + D_{root}(W_{cap} - W_{wil})}\]</p><p>following the Fortran SPEEDY documentation<sup class="footnote-reference"><a id="citeref-SPEEDY" href="#footnote-SPEEDY">[SPEEDY]</a></sup> which follows Viterbo and Beljiars 1995 <sup class="footnote-reference"><a id="citeref-Viterbo95" href="#footnote-Viterbo95">[Viterbo95]</a></sup>. The variables (or spatially prescribed arrays) are water content in the top soil layer <span>$W_{top}$</span> and the root layer below <span>$W_{root}$</span> using the vegetation fraction <span>$f_{veg} = veg_{high} + 0.8 veg_{low}$</span> composed of a (dimensionless) high and low vegetation cover per grid cell <span>$veg_{high}, veg_{low}$</span>. The constants are depth of top soil layer <span>$D_{top} = 7~cm$</span>, depth of root layer <span>$D_{root} = 21~cm$</span>, soil wetness at field capacity (volume fraction) <span>$W_{cap} = 0.3$</span>, and soil wetness at wilting point (volume fraction) <span>$W_{wil} = 0.17$</span>.</p><h2 id="Land-sea-mask"><a class="docs-heading-anchor" href="#Land-sea-mask">Land-sea mask</a><a id="Land-sea-mask-1"></a><a class="docs-heading-anchor-permalink" href="#Land-sea-mask" title="Permalink"></a></h2><p>SpeedyWeather uses a <em>fractional</em> land-sea mask, i.e. for every grid-point</p><ul><li>1 indicates land</li><li>0 indicates ocean</li><li>a value in between indicates a grid-cell partially covered by ocean and land</li></ul><p>The land-sea mask determines solely how to weight the surface fluxes coming from land or from the ocean. For the sensible heat fluxes this uses land and sea surface temperatures and weights the respective fluxes proportional to the fractional mask. Similar for evaporation. You can therefore define an ocean on top of a mountain, or a land without heat fluxes when the land-surface temperature is not defined, i.e. <code>NaN</code>. Let <span>$F_L, F_S$</span> be the fluxes coming from land and sea, respectively. Then the land-sea mask <span>$a \in [0,1]$</span> weights them as follows for the total flux <span>$F$</span></p><p class="math-container">\[F = aF_L + (1-a)F_S\]</p><p>but <span>$F=F_L$</span> if the sea flux is NaN (because the ocean temperature is not defined) and <span>$F=F_S$</span> if the land flux is NaN (because the land temperature or soil moisture is not defined, for sensible heat fluxes or evaporation), and <span>$F=0$</span> if both fluxes are NaN.</p><p>Setting the land-sea mask to ocean therefore will disable any fluxes that may come from land, and vice versa. However, with an ocean-everywhere land-sea mask you must also define sea surface temperatures everywhere, otherwise the fluxes in those regions will be zero.</p><p>For more details see <a href="../land_sea_mask/#The-land-sea-mask">The land-sea mask</a> implementation section.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Frierson2006"><a class="tag is-link" href="#citeref-Frierson2006">Frierson2006</a>Frierson, D. M. W., I. M. Held, and P. Zurita-Gotor, 2006: A Gray-Radiation Aquaplanet Moist GCM. Part I: Static Stability and Eddy Scale. J. Atmos. Sci., 63, 2548-2566. DOI: <a href="https://doi.org/10.1175/JAS3753.1">10.1175/JAS3753.1</a>. </li><li class="footnote" id="footnote-SPEEDY"><a class="tag is-link" href="#citeref-SPEEDY">SPEEDY</a>Franco Molteni and Fred Kucharski, 20??. Description of the ICTP AGCM (SPEEDY) Version 41. <a href="https://users.ictp.it/~kucharsk/speedy_description/km_ver41_appendixA.pdf">https://users.ictp.it/~kucharsk/speedy<em>description/km</em>ver41_appendixA.pdf</a></li><li class="footnote" id="footnote-Viterbo95"><a class="tag is-link" href="#citeref-Viterbo95">Viterbo95</a>Viterbo, P., and A. C. M. Beljaars, 1995: An Improved Land Surface Parameterization Scheme in the ECMWF Model and Its Validation. J. Climate, 8, 2716-2748, DOI:<a href="https://doi.org/10.1175/1520-0442(1995)008&lt;2716:AILSPS&gt;2.0.CO;2">10.1175/1520-0442(1995)008&lt;2716:AILSPS&gt;2.0.CO;2</a>. </li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../vertical_diffusion/">« Vertical diffusion</a><a class="docs-footer-nextpage" href="../spectral_transform/">Spherical Harmonic Transform »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 7 May 2024 08:04">Tuesday 7 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
